# Bare Node.JS API

Barebones project to develop an API to TP Server. It already includes some of the basic funcionalities that will be common to all projects, such as verifying the X-Tapps-Shared-Cloud-Secret and sending error messages in the application/problem+json format.

## Getting Started

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. See deployment for notes on how to deploy the project on a live system.

### Prerequisites

Download and install the latest LTS version of Node.js.

You can find the installer here:

    https://nodejs.org/en/

Or get it from the terminal:

    curl -sL https://deb.nodesource.com/setup_10.x | bash -
    apt-get install -y nodejs

### Installing

After installing Node.js open a terminal, change to the folder containing the application and run the following command:

    yarn

This will install all of the package's dependencies.

## Running the application

    yarn start

If you get errors running this command change the permission to App Engine Logs folder.

    sudo chown -R [user] /var/log/app_engine/custom_logs/

## Running the tests

In order to run the application tests use the following command:

    yarn test

Tests are run using the Mocha library for Node.js and coverage reports are generated by the Istanbul library.
The results can be found inside the `coverage` folder, after the tests are run.

## Docs

We use `esdoc` to generate the code documentation:

    yarn docs

## Deployment

To deploy the application in App Engine create a pipeline on GoCD, using the TPServer-Nodejs template.

It's also possible to deploy the application using the Google Cloud CLI, as explained in the following steps:

Login using your Google account:

    gcloud auth login

Set the project where the application should be deployed::

    gcloud config set project [project-name]

And lastly deploy the application:

    gcloud app deploy --version 1-0-0-0
